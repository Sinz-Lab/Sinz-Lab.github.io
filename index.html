<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toggle Button with Fetch</title>
    <style>
        /* Style for the button */
        .toggle-btn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            color: #fff;
            text-align: center;
            text-decoration: none;
            outline: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        /* Green style when true */
        .toggle-btn.true {
            background-color: green;
        }

        /* Red style when false */
        .toggle-btn.false {
            background-color: red;
        }

        /* Your existing styles for attachments */
        .attachment {
            list-style-type: none;
            padding: 0;
        }

        .attachment li {
            margin: 5px 0;
        }
    </style>
</head>
<body>

<!-- Toggle button element -->
<button id="toggleButton" class="toggle-btn true" onclick="toggleState()">Start</button>

<!-- Container to display the latest attachment -->
<div id="latestMessage"></div>

<script>
    var interval;

    // JavaScript function to toggle button state and update label and color
    function toggleState() {
        var button = document.getElementById("toggleButton");
        button.classList.toggle("true");
        button.classList.toggle("false");

        // Update label based on state
        if (button.classList.contains("true")) {
            button.innerHTML = "Start";
            clearInterval(interval);
        } else {
            button.innerHTML = "Stop";
            interval = setInterval(function() {
                sendUpdate();
                setTimeout(fetchLatestAttachment, 1400); // Wait for 1.4 seconds (1000 ms + 400 ms)
            }, 5000);
        }
    }

    // Function to send update to webhook
    function sendUpdate() {
        fetch('https://discord.com/api/webhooks/1199161755360841850/elro31SIg7AqUMxb36W_SU28BCpvIoT4X9DEaWvYoZovqCziHMVFTjpk5HGTNIuJDNJU', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content: 'Update' })
        })
        .then(response => console.log(response))
        .catch(error => console.error(error));
    }

    // Function to fetch the latest attachment
    function fetchLatestAttachment() {
        const url = 'https://discord.com/api/v9/channels/1199155279015718986/messages?limit=1';  // Fetch only 1 message
        const token = 'MTA2NDQ1MzAzNTExMzMzMjg2Nw.Gw6RDO.zAOOUlQQMS5Z2tMUEUh53QxygGhR4YZUvYVxpk';

        fetch(url, {
            method: 'GET',
            headers: {
                'Authorization': token,
                'Accept': '*/*',
                'Content-Type': 'application/json',
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
            }
        })
        .then(response => response.json())
        .then(data => {
            // Get the attachments of the most recent message
            const latestMessage = data[0];
            const attachments = latestMessage.attachments;

            // Display the attachments without title and message on the screen
            const latestMessageDiv = document.getElementById('latestMessage');
            latestMessageDiv.innerHTML = `
                <ul class="attachment">
                    ${attachments.map(attachment => `<li><img src="${attachment.url}" alt="${attachment.filename}" style="max-width: 100%; height: auto;"></li>`).join('')}
                </ul>
            `;
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>

</body>
</html>
